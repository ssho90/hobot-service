[Unit]
Description=Hobot FastAPI Service
After=network.target

[Service]
Type=simple
User=ec2-user
WorkingDirectory=/home/ec2-user/hobot-service/hobot
Environment="PATH=/home/ec2-user/hobot-service/hobot/venv/bin"
# Python ëª¨ë“ˆë¡œ ì‹¤í–‰í•˜ì—¬ ê°€ìƒí™˜ê²½ì˜ Pythonì„ ì‚¬ìš©
ExecStart=/home/ec2-user/hobot-service/hobot/venv/bin/python -m gunicorn -c gunicorn.conf.py asgi:asgi_app
Restart=always
RestartSec=10

# ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì •
ExecStartPre=/bin/mkdir -p /home/ec2-user/hobot-service/hobot/logs
ExecStartPre=/bin/chmod 755 /home/ec2-user/hobot-service/hobot/logs

# Python ì‹¤í–‰ íŒŒì¼ ê²€ì¦ ë° ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
ExecStartPre=/bin/bash -c "echo 'ğŸ” Checking Python executable...'"
ExecStartPre=/bin/bash -c "if [ ! -f /home/ec2-user/hobot-service/hobot/venv/bin/python ]; then echo 'âŒ ERROR: Python executable NOT FOUND at /home/ec2-user/hobot-service/hobot/venv/bin/python'; ls -la /home/ec2-user/hobot-service/hobot/venv/bin/ 2>&1 || echo 'venv/bin directory does not exist'; exit 1; fi"
ExecStartPre=/bin/bash -c "if [ ! -x /home/ec2-user/hobot-service/hobot/venv/bin/python ]; then echo 'âŒ ERROR: Python executable NOT EXECUTABLE (permissions issue)!'; ls -la /home/ec2-user/hobot-service/hobot/venv/bin/python; exit 1; fi"
ExecStartPre=/bin/bash -c "echo 'âœ… Python executable found and is executable'"
ExecStartPre=/bin/bash -c "/home/ec2-user/hobot-service/hobot/venv/bin/python --version 2>&1 || echo 'âš ï¸ Could not get Python version'"
ExecStartPre=/bin/bash -c "echo 'ğŸ“ Working directory: /home/ec2-user/hobot-service/hobot'"
ExecStartPre=/bin/bash -c "ls -la /home/ec2-user/hobot-service/hobot/venv/bin/python* 2>&1 || echo 'No Python files found in venv/bin'"

# ë¡œê·¸ ì„¤ì • (journalë¡œ ë¨¼ì € ì„¤ì •, íŒŒì¼ ë¦¬ë‹¤ì´ë ‰ì…˜ì€ gunicorn.conf.pyì—ì„œ ì²˜ë¦¬)
StandardOutput=journal
StandardError=journal
SyslogIdentifier=hobot

[Install]
WantedBy=multi-user.target